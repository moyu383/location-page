const key = "a6afcdeff7089690badc696e6584eade";
const url = `https://restapi.amap.com/v3/geocode/regeo?location=${lon},${lat}&key=${key}&output=json`;

const res = await fetch(url);
const data = await res.json();

if (data.status === "1") {
  const address = data.regeocode.formatted_address;
  const city = data.regeocode.addressComponent.city || data.regeocode.addressComponent.province;
  output.innerText += `\nğŸ“ åŸå¸‚ï¼š${city}\nğŸ¢ åœ°å€ï¼š${address}`;

  // åŒæ—¶å‘é€åˆ°é‚®ç®±
  const templateParams = {
    latitude: lat,
    longitude: lon,
    city,
    address,
    datetime: new Date().toLocaleString()
  };

  emailjs.send("service_xxx", "template_xxx", templateParams)
    .then(() => {
      output.innerText += "\nâœ… ä¿¡æ¯å·²å‘é€åˆ°é‚®ç®±";
    });
}
